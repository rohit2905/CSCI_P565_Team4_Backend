<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Search</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
      }

      .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        text-align: center;
        margin-bottom: 20px;
      }

      .order {
        border-bottom: 1px solid #ccc;
        padding: 10px 0;
      }

      .order:last-child {
        border-bottom: none;
      }

      .order-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .order-details {
        margin-top: 10px;
        padding-left: 20px;
      }
    </style>
  </head>
  <body>
    <h1>User Search</h1>
    <form id="searchForm">
      <label for="searchField">Search by:</label>
      <input type="text" id="searchField" required />
      <select id="database">
        <option value="users">Users</option>
        <option value="services">Services</option>
      </select>
      <button type="submit">Search</button>
    </form>
    <div id="searchResults"></div>
    <h1>Delivery Management System</h1>
    <form id="courierForm">
      <label for="courierSize">Courier Size (in cm):</label>
      <input type="text" id="courierSize" required />
      <label for="destination">Destination:</label>
      <select id="destination" required>
        <option value="domestic">Domestic</option>
        <option value="international">International</option>
      </select>
      <label for="speed">Delivery Speed:</label>
      <select id="speed" required>
        <option value="standard">Standard</option>
        <option value="express">Express</option>
      </select>
      <label for="budget">Budget:</label>
      <select id="budget" required>
        <option value="$">$</option>
        <option value="$$">$$</option>
        <option value="$$$">$$$</option>
      </select>
      <button type="submit">Recommend</button>
    </form>
    <p id="recommendation"></p>

    <div class="container">
      <h1>Order Details</h1>
      <form id="orderForm">
        <label for="orderId">Enter Order ID:</label>
        <input type="text" id="orderId" name="orderId" required />
        <button type="submit">Search</button>
      </form>
      <div id="orderDetails"></div>
    </div>

    <script>
      document
        .getElementById("searchForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const searchField = document.getElementById("searchField").value;
          const database = document.getElementById("database").value;
          const searchParam = database === "users" ? "email" : "serviceId";

          try {
            const response = await fetch(
              `http://localhost:3000/${database}?${searchParam}=${searchField}`
            );
            const data = await response.json();

            const searchResultsDiv = document.getElementById("searchResults");
            searchResultsDiv.innerHTML = "";

            if (response.ok) {
              let html = "";
              if (database === "users") {
                html = `
              <div>
                <h2>User Details</h2>
                <p><strong>ID:</strong> ${data._id}</p>
                <p><strong>User Type:</strong> ${data.userType}</p>
                <p><strong>Username:</strong> ${data.username}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Hashed Password:</strong> ${data.hashedPassword}</p>
                <p><strong>Salt:</strong> ${data.salt}</p>
                <p><strong>Expire OTP:</strong> ${data.expireotp}</p>
                <p><strong>OTP:</strong> ${data.otp}</p>
              </div>
            `;
              } else if (database === "services") {
                html = `
              <div>
                <h2>Service Details</h2>
                <p><strong>ID:</strong> ${data._id}</p>
                <p><strong>ServiceType:</strong> ${data.ServiceType}</p>
                <p><strong>ServiceId:</strong> ${data.ServiceId}</p>
                <p><strong>CarrierName:</strong> ${data.CarrierName}</p>
                <p><strong>Dimension:</strong> ${data.Dimension}</p>
                <p><strong>Price:</strong> ${data.Price}</p>
              </div>
            `;
              }
              searchResultsDiv.innerHTML = html;
            } else {
              searchResultsDiv.innerHTML = "<p>Data not found.</p>";
            }
          } catch (error) {
            console.error("Error searching:", error);
          }
        });

      document
        .getElementById("database")
        .addEventListener("change", function () {
          const selectedDatabase = this.value;
          const searchFieldLabel = document.querySelector(
            "label[for='searchField']"
          );
          searchFieldLabel.textContent =
            selectedDatabase === "users" ? "Email:" : "Service ID:";
        });

      // Frontend JavaScript code
      async function recommendCourier(event) {
        event.preventDefault();

        const courierSize = document.getElementById("courierSize").value;
        const destination = document.getElementById("destination").value;
        const speed = document.getElementById("speed").value;
        const budget = document.getElementById("budget").value;

        try {
          const response = await fetch(
            `http://localhost:3000/api/recommend-courier?size=${courierSize}&destination=${destination}&speed=${speed}&budget=${budget}`
          );
          const data = await response.json();

          const recommendation = data.recommendation; // Corrected: accessing recommendation from response data
          document.getElementById(
            "recommendation"
          ).innerText = `Recommended courier service: ${
            recommendation.courier
          } (Speed: ${recommendation.speed}, Cost: ${
            recommendation.cost
          }, Services: ${recommendation.services.join(", ")})`;
        } catch (error) {
          console.error("Error:", error);
          document.getElementById("recommendation").innerText =
            "Failed to get recommendation.";
        }
      }

      document
        .getElementById("courierForm")
        .addEventListener("submit", recommendCourier);

      async function fetchOrderDetails(event) {
        event.preventDefault();

        const orderId = document.getElementById("orderId").value;
        try {
          const response = await fetch(
            `http://localhost:3000/api/orders/${orderId}`
          );
          const order = await response.json();

          const orderDetailsContainer = document.getElementById("orderDetails");
          orderDetailsContainer.innerHTML = `
          <h2>Order Details</h2>
          <p><strong>Order ID:</strong> ${order.TrackingId}</p>
          <p><strong>From Address:</strong> ${order.Address_f}</p>
          <p><strong>To Address:</strong> ${order.Address_t}</p>
          <p><strong>Cost:</strong> $${order.Cost.toFixed(2)}</p>
          <p><strong>Carrier:</strong> ${order.Carrier}</p>
          <p><strong>Size:</strong> ${order.Size}</p>
          <p><strong>Weight:</strong> ${order.Weight}</p>
          <p><strong>Priority Status:</strong> ${order.PriorityStatus}</p>
          <p><strong>Payment Status:</strong> ${order.PaymentStatus}</p>
          <p><strong>Customer:</strong> ${order.Customer}</p>
          <p><strong>Location:</strong> ${order.Location}</p>
          <p><strong>Order Status:</strong> ${order.OrderStatus}</p>
          <p><strong>Drive:</strong> ${order.Drive}</p>
        `;
        } catch (error) {
          console.error("Error:", error);
          document.getElementById("orderDetails").innerHTML =
            "Failed to fetch order details.";
        }
      }

      document
        .getElementById("orderForm")
        .addEventListener("submit", fetchOrderDetails);

      fetchOrders();
    </script>
  </body>
</html>
